<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Login and Navigate to Profile</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
        }
        h1 {
            color: #2d3748;
            margin-bottom: 20px;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 16px;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
        }
        .status.info {
            background: #bee3f8;
            color: #2c5282;
        }
        .status.error {
            background: #fed7d7;
            color: #742a2a;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ RapidTriageME Profile Fix</h1>
        <div id="statusDiv">
            <div class="spinner"></div>
            <div class="status info">Initializing...</div>
        </div>
    </div>

    <script>
        const statusDiv = document.getElementById('statusDiv');

        async function autoLoginAndNavigate() {
            // Step 1: Clear existing session
            statusDiv.innerHTML = '<div class="status info">Step 1/3: Clearing existing session...</div>';
            localStorage.clear();
            sessionStorage.clear();
            await sleep(1000);

            // Step 2: Login with demo credentials
            statusDiv.innerHTML = '<div class="spinner"></div><div class="status info">Step 2/3: Logging in as Demo User...</div>';
            
            try {
                const loginResponse = await fetch('http://localhost:8787/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'demo@example.com',
                        password: 'demo1234'
                    })
                });

                const loginData = await loginResponse.json();

                if (loginResponse.ok && loginData.token) {
                    // Store all authentication data
                    localStorage.setItem('rapidtriage_auth_token', loginData.token);
                    localStorage.setItem('rapidtriage_refresh_token', loginData.refreshToken);
                    localStorage.setItem('rapidtriage_user', JSON.stringify(loginData.user));
                    
                    statusDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ Login successful!<br>
                            User: ${loginData.user.name}<br>
                            Email: ${loginData.user.email}<br>
                            Plan: ${loginData.user.subscription.plan}
                        </div>
                    `;
                    
                    await sleep(2000);
                    
                    // Step 3: Navigate to profile page
                    statusDiv.innerHTML = '<div class="status info">Step 3/3: Navigating to profile page...</div>';
                    await sleep(1000);
                    
                    window.location.href = 'http://localhost:8787/profile';
                } else {
                    throw new Error(loginData.error || 'Login failed');
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Start the process automatically
        window.onload = () => {
            autoLoginAndNavigate();
        };
    </script>
</body>
</html>